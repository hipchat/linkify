<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <title>Linkify.js tests</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/qunit/qunit-1.10.0.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.10.0.css" type="text/css">
    <script src="linkify.js"></script>
  </head>
  <body>
    <div id="qunit"></div>
  </body>
  <script type="text/javascript" charset="utf-8">

    // keep replacements simple to shorten strings needed for testing
    linkify.add_wbrs = false;
    linkify.link_target = null;
    linkify.link_titles = false;

    // emails -> html
    var emails = {
      'user@example.com':
        '<a href="mailto:user@example.com">user@example.com</a>',
      'user-foo@blah.example.com':
        '<a href="mailto:user-foo@blah.example.com">user-foo@blah.example.com</a>'
    };
    test("emails", function() {
      for (var line in emails) {
        equal(linkify.linkify(line), emails[line], line);
      }
    });

    // full URLs -> html
    var urls = {
      'http://www.example.com':
        '<a href="http://www.example.com">http://www.example.com</a>',
      'http://www.example.com/blah':
        '<a href="http://www.example.com/blah">http://www.example.com/blah</a>',
    };
    test("full urls", function() {
      for (var line in urls) {
        equal(linkify.linkify(line), urls[line], line);
      }
    });

    // partial URLs -> html
    var urls = {
      'example.com': '<a href="http://example.com">example.com</a>',
      'www.example.com': '<a href="http://www.example.com">www.example.com</a>',
      'example.com/foo': '<a href="http://example.com/foo">example.com/foo</a>',
    };
    test("partial urls", function() {
      for (var line in urls) {
        equal(linkify.linkify(line), urls[line], line);
      }
    });

    // test that matched items are returned
    test("returns matched items", function() {
      var items = {
        // email
        'email@example.com': ['email@example.com'],

        // simple stuff
        'http://example.com/blah': ['http://example.com/blah'],
        'http://example.com/blah?foo=bar': ['http://example.com/blah?foo=bar'],
        'http://example.com?foo=bar': ['http://example.com?foo=bar'],
        'http://example.com?foo=bar#blah': ['http://example.com?foo=bar#blah'],

        // surrounding punctuation
        'link:http://example.com': ['http://example.com'],
        'http://example.com.': ['http://example.com'],
        ',http://example.com,': ['http://example.com'],
        '(http://example.com)': ['http://example.com'],
        '<http://example.com>': ['http://example.com'],

        // parens in url
        // 'http://foo.com/blah_(wikipedia)': ['http://foo.com/blah_(wikipedia)'],

        // file://
        'file://localhost/foo.html': ['file://localhost/foo.html'],

        // local windows path
        // '\\\\filez\\blah': ['\\\\filez\\blah'],

        // ips
        'http://192.168.0.1': ['http://192.168.0.1'],
        'http://192.168.0.1/admin': ['http://192.168.0.1/admin'],

        // stuff we don't want matched
        'file.py': [],
        'thing.sh': [],
      };
      for (var text in items) {
        var expected_matches = items[text];
        var matched = [];
        linkify.linkify(text, matched);
        deepEqual(matched, expected_matches, text);
      }
    });

    // link target
    test("link_target", function() {
      linkify.link_target = '_blank';
      var links = {
        'user@example.com': '<a target="_blank" href="mailto:user@example.com">user@example.com</a>',
        'example.com': '<a target="_blank" href="http://example.com">example.com</a>',
        'http://www.example.com': '<a target="_blank" href="http://www.example.com">http://www.example.com</a>',
      };
      for (var text in links) {
        equal(linkify.linkify(text), links[text], text);
      }
      linkify.link_target = null;
    });

    // link titles
    test("link_titles", function() {
      linkify.link_titles = true;
      var links = {
        'user@example.com': '<a href="mailto:user@example.com" title="Email user@example.com">user@example.com</a>',
        'example.com': '<a href="http://example.com" title="http://example.com">example.com</a>',
        'http://www.example.com': '<a href="http://www.example.com" title="http://www.example.com">http://www.example.com</a>',
      };
      for (var text in links) {
        equal(linkify.linkify(text), links[text], text);
      }
      linkify.link_titles = false;
    });

    // truncate length
    test("truncate_length", function() {
      linkify.truncate_length = 15;
      var links = {
        'user@blah.example.com': '<a href="mailto:user@blah.example.com">user@blah.examp...</a>',
        'blah.foo.example.com': '<a href="http://blah.foo.example.com">blah.foo.exampl...</a>',
        'http://www.example.com': '<a href="http://www.example.com">http://www.exam...</a>',
      };
      for (var text in links) {
        equal(linkify.linkify(text), links[text], text);
      }
      linkify.truncate_length = null;
    });

    // test add_wbrs
    test("add_wbrs", function() {
      linkify.add_wbrs = true;
      var text = 'example.com/foo?a=b';
      var expected = '<a href="http://example.com/foo?a=b">example.com<wbr>/foo?a<wbr>=b</a>';
      var actual = linkify.linkify(text);
      equal(actual, expected, text);
      linkify.add_wbrs = false;
    });

  </script>
</html>
